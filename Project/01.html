<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Geo-Analyst: 10 Missions</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        body { font-family: 'Sarabun', sans-serif; margin: 0; display: flex; flex-direction: column; height: 100vh; background: #2c3e50; overflow: hidden; }
        
        /* Header */
        header { 
            background: #2c3e50; color: white; padding: 12px 20px; 
            display: flex; justify-content: space-between; align-items: center; 
            box-shadow: 0 4px 10px rgba(0,0,0,0.3); z-index: 1000;
        }
        .score-board { font-size: 1.1rem; background: #e67e22; padding: 5px 15px; border-radius: 20px; font-weight: bold; }
        
        /* Map Container */
        .container { flex-grow: 1; position: relative; }
        #map { width: 100%; height: 100%; background: #aad3df; }

        /* Map Controls (‡∏Ç‡∏ß‡∏≤‡∏ö‡∏ô) */
        .map-controls {
            position: absolute; top: 20px; right: 20px;
            background: rgba(255, 255, 255, 0.95);
            padding: 10px; border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            z-index: 900; display: flex; flex-direction: column; gap: 8px; width: 150px;
        }
        .map-btn {
            border: 1px solid #ddd; background: white; padding: 8px;
            border-radius: 5px; cursor: pointer; text-align: left; font-size: 0.85rem;
            transition: 0.2s; display: flex; align-items: center; gap: 8px;
        }
        .map-btn:hover { background: #f0f2f5; }
        .map-btn.active { background: #3498db; color: white; border-color: #3498db; }

        /* Mission Panel (‡∏•‡πà‡∏≤‡∏á‡∏ã‡πâ‡∏≤‡∏¢) */
        .mission-panel {
            position: absolute; bottom: 30px; left: 20px;
            width: 340px;
            background: rgba(255, 255, 255, 0.95);
            padding: 20px; border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            z-index: 900; border-left: 6px solid #e74c3c;
        }
        .m-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 5px; }
        .m-title { font-size: 1.1rem; font-weight: bold; color: #c0392b; }
        .m-desc { font-size: 0.95rem; color: #333; margin-bottom: 10px; line-height: 1.5; }
        .current-score { font-size: 0.8rem; color: #27ae60; font-weight: bold; }
        
        /* Hints */
        .hints { background: #ecf0f1; padding: 10px; border-radius: 6px; font-size: 0.85rem; margin-bottom: 15px; }
        .hint-item { margin-bottom: 4px; display: flex; align-items: center; gap: 5px; }
        
        button.next-btn {
            background: #27ae60; color: white; border: none; padding: 12px; width: 100%;
            border-radius: 6px; font-weight: bold; cursor: pointer; font-size: 1rem;
            display: none; transition: 0.2s;
        }
        button.next-btn:hover { background: #2ecc71; }

    </style>
</head>
<body>

<header>
    <div style="font-weight:bold; font-size:1.1rem;"><i class="fas fa-globe-asia"></i> Geo-Analyst: Thailand Elite</div>
    <div class="score-board">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏£‡∏ß‡∏°: <span id="total-score">0</span></div>
</header>

<div class="container">
    <div id="map"></div>

    <div class="map-controls">
        <button class="map-btn active" onclick="switchMap('street', this)">
            <i class="fas fa-road"></i> ‡∏ñ‡∏ô‡∏ô (‡∏õ‡∏Å‡∏ï‡∏¥)
        </button>
        <button class="map-btn" onclick="switchMap('topo', this)">
            <i class="fas fa-mountain"></i> ‡∏†‡∏π‡∏°‡∏¥‡∏õ‡∏£‡∏∞‡πÄ‡∏ó‡∏® (‡∏™‡∏π‡∏á‡∏ï‡πà‡∏≥)
        </button>
        <button class="map-btn" onclick="switchMap('sat', this)">
            <i class="fas fa-satellite"></i> ‡∏î‡∏≤‡∏ß‡πÄ‡∏ó‡∏µ‡∏¢‡∏° (‡∏à‡∏£‡∏¥‡∏á)
        </button>
    </div>

    <div class="mission-panel">
        <div class="m-header">
            <div class="m-title" id="m-title">Loading...</div>
            <div class="current-score">‡∏î‡πà‡∏≤‡∏ô‡∏ô‡∏µ‡πâ: <span id="level-score">100</span> pt</div>
        </div>
        <div class="m-desc" id="m-desc">...</div>
        
        <div class="hints">
            <div style="font-weight:bold; margin-bottom:5px;">‡∏Ñ‡∏≥‡πÉ‡∏ö‡πâ‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à:</div>
            <div id="hint-list"></div>
        </div>

        <button class="next-btn" id="btn-next" onclick="nextLevel()">‡πÑ‡∏õ‡∏î‡πà‡∏≤‡∏ô‡∏ï‡πà‡∏≠‡πÑ‡∏õ ‚ñ∂</button>
    </div>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
    // --- 1. Map Setup (Locked to Thailand) ---
    const thailandBounds = L.latLngBounds(L.latLng(5.0, 97.0), L.latLng(21.0, 106.0));
    const map = L.map('map', {
        center: [13.0, 101.5], zoom: 6, minZoom: 5,
        maxBounds: thailandBounds, maxBoundsViscosity: 1.0
    });

    const layers = {
        street: L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { attribution: 'OSM' }),
        topo: L.tileLayer('https://{s}.tile.opentopomap.org/{z}/{x}/{y}.png', { maxZoom: 17, attribution: 'OpenTopoMap' }),
        sat: L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', { attribution: 'Esri' })
    };
    let currentLayer = layers.street;
    currentLayer.addTo(map);

    // --- 2. Game Variables ---
    let totalScore = 0;
    let currentLevelScore = 100; // ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÄ‡∏ï‡πá‡∏°‡∏ï‡πà‡∏≠‡∏î‡πà‡∏≤‡∏ô
    let currentLevelIdx = 0;
    let isLevelDone = false;

    // --- 3. The 10 Missions ---
    const levels = [
        {
            title: "1. ‡πÄ‡∏°‡∏∑‡∏≠‡∏á‡πÄ‡∏Å‡πà‡∏≤‡∏≠‡∏¢‡∏∏‡∏ò‡∏¢‡∏≤",
            desc: "‡∏ß‡∏≠‡∏£‡πå‡∏°‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á! ‡∏à‡∏á‡∏´‡∏≤‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏Ç‡∏≠‡∏á <b>'‡∏à.‡∏û‡∏£‡∏∞‡∏ô‡∏Ñ‡∏£‡∏®‡∏£‡∏µ‡∏≠‡∏¢‡∏∏‡∏ò‡∏¢‡∏≤'</b> (‡πÄ‡∏´‡∏ô‡∏∑‡∏≠ ‡∏Å‡∏ó‡∏°. ‡πÄ‡∏•‡πá‡∏Å‡∏ô‡πâ‡∏≠‡∏¢)",
            hints: ["‡πÉ‡∏ä‡πâ '‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà‡∏ñ‡∏ô‡∏ô' ‡∏à‡∏∞‡∏´‡∏≤‡∏á‡πà‡∏≤‡∏¢‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î"],
            target: [14.3532, 100.5684], radius: 35000, zoom: 7, center: [14.0, 100.5]
        },
        {
            title: "2. ‡∏´‡∏ô‡∏µ‡∏ô‡πâ‡∏≥‡∏ó‡πà‡∏ß‡∏° (‡∏ô‡πà‡∏≤‡∏ô)",
            desc: "‡∏î‡∏π‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏π‡∏á! ‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏µ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß‡∏Ñ‡∏∑‡∏≠‡∏ô‡πâ‡∏≥‡∏ó‡πà‡∏ß‡∏° ‡∏à‡∏á‡∏à‡∏¥‡πâ‡∏° <b>'‡∏†‡∏π‡πÄ‡∏Ç‡∏≤ (‡∏™‡∏µ‡∏ô‡πâ‡∏≥‡∏ï‡∏≤‡∏•)'</b> ‡∏ù‡∏±‡πà‡∏á‡∏ã‡πâ‡∏≤‡∏¢‡∏´‡∏£‡∏∑‡∏≠‡∏Ç‡∏ß‡∏≤‡∏Ç‡∏≠‡∏á‡πÄ‡∏°‡∏∑‡∏≠‡∏á",
            hints: ["‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô '‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà‡∏†‡∏π‡∏°‡∏¥‡∏õ‡∏£‡∏∞‡πÄ‡∏ó‡∏®' (Topo)", "‡∏à‡∏¥‡πâ‡∏°‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô‡∏™‡∏µ‡∏ô‡πâ‡∏≥‡∏ï‡∏≤‡∏•‡πÄ‡∏Ç‡πâ‡∏°"],
            checkType: "topo_nan", zoom: 10, center: [18.78, 100.78]
        },
        {
            title: "3. ‡∏õ‡∏≠‡∏î‡∏Å‡∏£‡∏∏‡∏á‡πÄ‡∏ó‡∏û‡∏Ø (‡∏ö‡∏≤‡∏á‡∏Å‡∏∞‡πÄ‡∏à‡πâ‡∏≤)",
            desc: "‡∏à‡∏á‡∏´‡∏≤‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏µ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß‡∏£‡∏π‡∏õ <b>'‡∏Å‡∏£‡∏∞‡πÄ‡∏û‡∏≤‡∏∞‡∏´‡∏°‡∏π'</b> ‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏•‡πâ‡∏≠‡∏°‡∏î‡πâ‡∏ß‡∏¢‡πÅ‡∏°‡πà‡∏ô‡πâ‡∏≥‡πÄ‡∏à‡πâ‡∏≤‡∏û‡∏£‡∏∞‡∏¢‡∏≤ (‡∏™‡∏°‡∏∏‡∏ó‡∏£‡∏õ‡∏£‡∏≤‡∏Å‡∏≤‡∏£)",
            hints: ["‡∏≠‡∏¢‡∏π‡πà‡∏ó‡∏¥‡∏®‡πÉ‡∏ï‡πâ‡∏Ç‡∏≠‡∏á‡∏Å‡∏£‡∏∏‡∏á‡πÄ‡∏ó‡∏û‡∏Ø", "‡∏°‡∏≠‡∏á‡∏´‡∏≤‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏õ‡πà‡∏≤‡∏™‡∏µ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß‡∏Ç‡∏ô‡∏≤‡∏î‡πÉ‡∏´‡∏ç‡πà"],
            target: [13.695, 100.560], radius: 4000, zoom: 11, center: [13.70, 100.55]
        },
        {
            title: "4. ‡∏ñ‡πâ‡∏≥‡∏´‡∏•‡∏ß‡∏á (‡πÄ‡∏ä‡∏µ‡∏¢‡∏á‡∏£‡∏≤‡∏¢)",
            desc: "‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à‡∏Å‡∏π‡πâ‡∏†‡∏±‡∏¢! ‡∏à‡∏á‡∏´‡∏≤ <b>'‡πÄ‡∏ó‡∏∑‡∏≠‡∏Å‡πÄ‡∏Ç‡∏≤‡∏î‡∏≠‡∏¢‡∏ô‡∏≤‡∏á‡∏ô‡∏≠‡∏ô'</b> (‡∏ó‡∏µ‡πà‡∏ï‡∏±‡πâ‡∏á‡∏ñ‡πâ‡∏≥‡∏´‡∏•‡∏ß‡∏á) ‡πÄ‡∏´‡∏ô‡∏∑‡∏≠ ‡∏≠.‡πÅ‡∏°‡πà‡∏™‡∏≤‡∏¢",
            hints: ["‡πÑ‡∏õ‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏ô‡∏∑‡∏≠‡∏™‡∏∏‡∏î‡∏Ç‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡πÄ‡∏ó‡∏® (‡πÄ‡∏ä‡∏µ‡∏¢‡∏á‡∏£‡∏≤‡∏¢)", "‡∏î‡∏π‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà Topo ‡∏´‡∏≤‡∏†‡∏π‡πÄ‡∏Ç‡∏≤‡∏™‡∏π‡∏á‡∏£‡∏¥‡∏°‡∏ä‡∏≤‡∏¢‡πÅ‡∏î‡∏ô"],
            target: [20.3800, 99.8600], radius: 5000, zoom: 12, center: [20.40, 99.88]
        },
        {
            title: "5. ‡∏ó‡πà‡∏≤‡πÄ‡∏£‡∏∑‡∏≠‡πÅ‡∏´‡∏•‡∏°‡∏â‡∏ö‡∏±‡∏á (‡∏ä‡∏•‡∏ö‡∏∏‡∏£‡∏µ)",
            desc: "‡∏®‡∏π‡∏ô‡∏¢‡πå‡∏Å‡∏•‡∏≤‡∏á‡∏Ç‡∏ô‡∏™‡πà‡∏á‡∏ó‡∏≤‡∏á‡∏ó‡∏∞‡πÄ‡∏•! ‡∏à‡∏á‡∏´‡∏≤‡∏ó‡πà‡∏≤‡πÄ‡∏£‡∏∑‡∏≠‡∏ô‡πâ‡∏≥‡∏•‡∏∂‡∏Å‡∏ó‡∏µ‡πà‡∏°‡∏µ <b>'‡∏ï‡∏π‡πâ‡∏Ñ‡∏≠‡∏ô‡πÄ‡∏ó‡∏ô‡πÄ‡∏ô‡∏≠‡∏£‡πå'</b> ‡∏¢‡∏∑‡πà‡∏ô‡∏•‡∏á‡πÑ‡∏õ‡πÉ‡∏ô‡∏ó‡∏∞‡πÄ‡∏•",
            hints: ["‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô '‡∏†‡∏≤‡∏û‡∏î‡∏≤‡∏ß‡πÄ‡∏ó‡∏µ‡∏¢‡∏°'", "‡∏≠‡∏¢‡∏π‡πà‡∏ä‡∏≤‡∏¢‡∏ù‡∏±‡πà‡∏á‡∏ä‡∏•‡∏ö‡∏∏‡∏£‡∏µ (‡πÉ‡∏Å‡∏•‡πâ‡∏û‡∏±‡∏ó‡∏¢‡∏≤)"],
            target: [13.085, 100.880], radius: 4000, zoom: 11, center: [13.10, 100.90]
        },
        {
            title: "6. ‡∏ó‡∏∞‡πÄ‡∏•‡∏™‡∏≤‡∏ö‡∏™‡∏á‡∏Ç‡∏•‡∏≤",
            desc: "‡∏à‡∏á‡∏´‡∏≤ <b>'‡∏ó‡∏∞‡πÄ‡∏•‡∏™‡∏≤‡∏ö‡∏ó‡∏µ‡πà‡πÉ‡∏´‡∏ç‡πà‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î'</b> ‡πÉ‡∏ô‡∏õ‡∏£‡∏∞‡πÄ‡∏ó‡∏®‡πÑ‡∏ó‡∏¢ (‡∏†‡∏≤‡∏Ñ‡πÉ‡∏ï‡πâ)",
            hints: ["‡∏°‡∏≠‡∏á‡∏´‡∏≤‡πÅ‡∏´‡∏•‡πà‡∏á‡∏ô‡πâ‡∏≥‡∏Ç‡∏ô‡∏≤‡∏î‡πÉ‡∏´‡∏ç‡πà‡πÉ‡∏Å‡∏•‡πâ‡∏´‡∏≤‡∏î‡πÉ‡∏´‡∏ç‡πà", "‡∏ã‡∏π‡∏°‡∏î‡∏π‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà‡∏ñ‡∏ô‡∏ô‡∏à‡∏∞‡πÄ‡∏´‡πá‡∏ô‡∏ä‡∏∑‡πà‡∏≠‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô"],
            target: [7.450, 100.300], radius: 20000, zoom: 9, center: [7.20, 100.40]
        },
        {
            title: "7. ‡∏†‡∏π‡∏ó‡∏±‡∏ö‡πÄ‡∏ö‡∏¥‡∏Å (‡πÄ‡∏û‡∏ä‡∏£‡∏ö‡∏π‡∏£‡∏ì‡πå)",
            desc: "‡∏´‡∏≤‡∏à‡∏∏‡∏î‡∏ä‡∏°‡∏ß‡∏¥‡∏ß‡∏ó‡∏∞‡πÄ‡∏•‡∏´‡∏°‡∏≠‡∏Å! ‡∏à‡∏á‡∏´‡∏≤ <b>'‡∏¢‡∏≠‡∏î‡πÄ‡∏Ç‡∏≤‡∏™‡∏π‡∏á'</b> ‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏ñ‡∏ô‡∏ô‡∏Ñ‡∏î‡πÄ‡∏Ñ‡∏µ‡πâ‡∏¢‡∏ß ‡πÉ‡∏ô ‡∏à.‡πÄ‡∏û‡∏ä‡∏£‡∏ö‡∏π‡∏£‡∏ì‡πå",
            hints: ["‡πÉ‡∏ä‡πâ‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà Topo ‡∏´‡∏≤‡∏à‡∏∏‡∏î‡∏™‡∏µ‡∏ô‡πâ‡∏≥‡∏ï‡∏≤‡∏•‡πÄ‡∏Ç‡πâ‡∏°", "‡∏≠‡∏¢‡∏π‡πà‡∏£‡∏≠‡∏¢‡∏ï‡πà‡∏≠‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏´‡∏•‡πà‡∏°‡πÄ‡∏Å‡πà‡∏≤-‡∏î‡πà‡∏≤‡∏ô‡∏ã‡πâ‡∏≤‡∏¢"],
            target: [16.900, 101.100], radius: 6000, zoom: 11, center: [16.85, 101.15]
        },
        {
            title: "8. ‡πÄ‡∏Å‡∏≤‡∏∞‡∏™‡∏°‡∏∏‡∏¢ (‡∏™‡∏∏‡∏£‡∏≤‡∏©‡∏é‡∏£‡πå‡∏ò‡∏≤‡∏ô‡∏µ)",
            desc: "‡∏à‡∏á‡∏´‡∏≤ <b>'‡πÄ‡∏Å‡∏≤‡∏∞‡∏ó‡πà‡∏≠‡∏á‡πÄ‡∏ó‡∏µ‡πà‡∏¢‡∏ß‡∏Ç‡∏ô‡∏≤‡∏î‡πÉ‡∏´‡∏ç‡πà'</b> ‡πÉ‡∏ô‡∏≠‡πà‡∏≤‡∏ß‡πÑ‡∏ó‡∏¢",
            hints: ["‡∏≠‡∏¢‡∏π‡πà‡∏ó‡∏≤‡∏á‡∏Ç‡∏ß‡∏≤‡∏Ç‡∏≠‡∏á‡∏™‡∏∏‡∏£‡∏≤‡∏©‡∏é‡∏£‡πå‡∏ò‡∏≤‡∏ô‡∏µ", "‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏Å‡∏≤‡∏∞‡πÉ‡∏´‡∏ç‡πà‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏™‡∏ô‡∏≤‡∏°‡∏ö‡∏¥‡∏ô"],
            target: [9.500, 100.000], radius: 10000, zoom: 9, center: [9.30, 99.80]
        },
        {
            title: "9. ‡πÄ‡∏Ç‡∏∑‡πà‡∏≠‡∏ô‡∏†‡∏π‡∏°‡∏¥‡∏û‡∏• (‡∏ï‡∏≤‡∏Å)",
            desc: "‡∏à‡∏á‡∏´‡∏≤ <b>'‡πÄ‡∏Ç‡∏∑‡πà‡∏≠‡∏ô‡∏Ñ‡∏≠‡∏ô‡∏Å‡∏£‡∏µ‡∏ï‡πÇ‡∏Ñ‡πâ‡∏á'</b> ‡∏Ç‡∏ô‡∏≤‡∏î‡πÉ‡∏´‡∏ç‡πà‡∏Å‡∏±‡πâ‡∏ô‡πÅ‡∏°‡πà‡∏ô‡πâ‡∏≥‡∏õ‡∏¥‡∏á",
            hints: ["‡πÉ‡∏ä‡πâ‡∏†‡∏≤‡∏û‡∏î‡∏≤‡∏ß‡πÄ‡∏ó‡∏µ‡∏¢‡∏°‡∏à‡∏∞‡πÄ‡∏´‡πá‡∏ô‡∏™‡∏±‡∏ô‡πÄ‡∏Ç‡∏∑‡πà‡∏≠‡∏ô‡∏ä‡∏±‡∏î", "‡∏≠‡∏¢‡∏π‡πà‡∏ó‡∏≤‡∏á‡πÄ‡∏´‡∏ô‡∏∑‡∏≠‡∏Ç‡∏≠‡∏á ‡∏à.‡∏ï‡∏≤‡∏Å"],
            target: [17.243, 98.973], radius: 3000, zoom: 12, center: [17.20, 99.00]
        },
        {
            title: "10. ‡∏û‡∏£‡∏∞‡∏õ‡∏ê‡∏°‡πÄ‡∏à‡∏î‡∏µ‡∏¢‡πå (‡∏ô‡∏Ñ‡∏£‡∏õ‡∏ê‡∏°)",
            desc: "‡∏î‡πà‡∏≤‡∏ô‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢! ‡∏à‡∏á‡∏´‡∏≤ <b>'‡πÄ‡∏à‡∏î‡∏µ‡∏¢‡πå‡∏™‡∏µ‡∏ó‡∏≠‡∏á‡∏ó‡∏µ‡πà‡πÉ‡∏´‡∏ç‡πà‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î'</b> ‡πÉ‡∏à‡∏Å‡∏•‡∏≤‡∏á‡πÄ‡∏°‡∏∑‡∏≠‡∏á‡∏ô‡∏Ñ‡∏£‡∏õ‡∏ê‡∏°",
            hints: ["‡∏î‡∏π‡∏à‡∏≤‡∏Å‡∏†‡∏≤‡∏û‡∏î‡∏≤‡∏ß‡πÄ‡∏ó‡∏µ‡∏¢‡∏°‡∏à‡∏∞‡πÄ‡∏´‡πá‡∏ô‡∏≠‡∏á‡∏Ñ‡πå‡πÄ‡∏à‡∏î‡∏µ‡∏¢‡πå‡∏Å‡∏•‡∏°‡πÉ‡∏´‡∏ç‡πà", "‡∏≠‡∏¢‡∏π‡πà‡∏ó‡∏≤‡∏á‡∏ï‡∏∞‡∏ß‡∏±‡∏ô‡∏ï‡∏Å‡∏Ç‡∏≠‡∏á ‡∏Å‡∏ó‡∏°."],
            target: [13.819, 100.060], radius: 1000, zoom: 14, center: [13.82, 100.06]
        }
    ];

    // --- 4. Game Functions ---

    function switchMap(type, btn) {
        map.removeLayer(currentLayer);
        currentLayer = layers[type];
        currentLayer.addTo(map);
        document.querySelectorAll('.map-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
    }

    function loadLevel(idx) {
        isLevelDone = false;
        currentLevelScore = 100; // ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏î‡πà‡∏≤‡∏ô
        document.getElementById('level-score').innerText = currentLevelScore;
        document.getElementById('level-score').style.color = "#27ae60";

        const lvl = levels[idx];
        document.getElementById('m-title').innerText = `${lvl.title} (${idx+1}/10)`;
        document.getElementById('m-desc').innerHTML = lvl.desc;
        document.getElementById('btn-next').style.display = 'none';
        
        const list = document.getElementById('hint-list');
        list.innerHTML = "";
        lvl.hints.forEach(h => { list.innerHTML += `<div class="hint-item"><i class="fas fa-search" style="color:#e67e22;"></i> ${h}</div>`; });

        map.flyTo(lvl.center, lvl.zoom, { duration: 1.5 });
    }

    map.on('click', function(e) {
        if(isLevelDone) return;
        const lvl = levels[currentLevelIdx];
        let isCorrect = false;

        // Logic ‡∏î‡πà‡∏≤‡∏ô‡∏ô‡πà‡∏≤‡∏ô (‡πÄ‡∏ä‡πá‡∏Ñ Longitude ‡∏´‡∏∏‡∏ö‡πÄ‡∏Ç‡∏≤)
        if (lvl.checkType === "topo_nan") {
            const lng = e.latlng.lng;
            if (lng < 100.745 || lng > 100.815) isCorrect = true;
            else {
                // ‡∏ú‡∏¥‡∏î‡∏î‡πà‡∏≤‡∏ô‡∏ô‡πà‡∏≤‡∏ô
                L.rectangle([[18.6, 100.745], [19.0, 100.815]], {color: 'red', fillOpacity: 0.1, weight:1}).addTo(map);
            }
        } 
        // Logic ‡∏î‡πà‡∏≤‡∏ô‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ (‡∏ß‡∏±‡∏î‡∏£‡∏∞‡∏¢‡∏∞)
        else {
            const dist = map.distance(e.latlng, lvl.target);
            if (dist <= lvl.radius) isCorrect = true;
        }

        if (isCorrect) {
            // ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á
            isLevelDone = true;
            totalScore += currentLevelScore;
            document.getElementById('total-score').innerText = totalScore;
            
            L.popup().setLatLng(e.latlng).setContent("‚úÖ <b>‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á! ‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à</b>").openOn(map);
            if(lvl.target) L.circle(lvl.target, {color:'green', radius: lvl.radius}).addTo(map);
            
            const btn = document.getElementById('btn-next');
            btn.style.display = 'block';
            
            if(currentLevelIdx === levels.length -1) {
                btn.innerText = "üèÜ ‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô";
                btn.onclick = showFinalScore;
            }
        } else {
            // ‡∏ú‡∏¥‡∏î
            if (currentLevelScore > 0) currentLevelScore -= 10; // ‡∏´‡∏±‡∏Å‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô
            document.getElementById('level-score').innerText = currentLevelScore;
            document.getElementById('level-score').style.color = "#c0392b";
            
            L.popup().setLatLng(e.latlng).setContent("‚ùå <b>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å! (‡∏´‡∏±‡∏Å 10 ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô)</b><br>‡∏•‡∏≠‡∏á‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà ‡∏´‡∏£‡∏∑‡∏≠‡∏≠‡πà‡∏≤‡∏ô‡∏Ñ‡∏≥‡πÉ‡∏ö‡πâ‡∏î‡∏π‡∏ô‡∏∞").openOn(map);
        }
    });

    function nextLevel() {
        if (currentLevelIdx < levels.length - 1) {
            currentLevelIdx++;
            loadLevel(currentLevelIdx);
        }
    }

    function showFinalScore() {
        let rank = "‡∏ô‡∏±‡∏Å‡∏™‡∏≥‡∏£‡∏ß‡∏à‡∏°‡∏∑‡∏≠‡πÉ‡∏´‡∏°‡πà";
        if(totalScore >= 900) rank = "üó∫Ô∏è ‡∏õ‡∏£‡∏°‡∏≤‡∏à‡∏≤‡∏£‡∏¢‡πå‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà (Map Master)";
        else if(totalScore >= 700) rank = "üßê ‡∏ú‡∏π‡πâ‡πÄ‡∏ä‡∏µ‡πà‡∏¢‡∏ß‡∏ä‡∏≤‡∏ç (Expert)";
        else if(totalScore >= 500) rank = "üëÆ ‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏†‡∏≤‡∏Ñ‡∏™‡∏ô‡∏≤‡∏° (Officer)";

        alert(`‡∏à‡∏ö‡πÄ‡∏Å‡∏°! ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏£‡∏ß‡∏°: ${totalScore}/1000\n‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡∏∑‡∏≠: ${rank}`);
        location.reload();
    }

    // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏°
    loadLevel(0);

</script>
</body>
</html>